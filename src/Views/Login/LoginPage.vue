<script>
  import Toastiff from '@/Utils/Toastiff.vue';
  import api from '@/Utils/axios';
  import Icons from '@/components/Icons.vue';
  export default {
    name: "LoginPage",
    components: {
        Icons,
        Toastiff
    },
    data() {
    return {
      login: '',
      showSvg:false,
      password: '',
      type: false,
      loading: false, 
      toastOptions: {
        open: false,
        text: "",
      },
    }
  },
  methods: {
    async handleLogin() {
      
      if (!this.login || !this.password) {
        this.toastOptions = {
          open: true,
          text: "Iltimos, login va parolni kiriting",
          type: "error",
        };
        return;
      }
  
      this.loading = true; 
  
      try {
        const response = await api.post('/user/signin', {
          username: this.login,
          password: this.password
        });
        console.log(response);
        
        if (response.status==201|| response.status==200) {
          this.toastOptions = {
            open: true,
            text: "Вход успешен",
            type:"success",
          };
          localStorage.setItem('user', JSON.stringify(response?.data));
          this.$router.push('/');
        }
        else{
          this.toastOptions = {
            open: true,
            text: "Kirib bolmaydi",
            type:"error",
          };
        }
      } catch (error) {
        this.toastOptions = {
          open: true,
          text: error.response?.data?.message || "Xatolik yuz berdi",
          type: "error"
        };
      } finally {
        this.loading = false;
      }
    }
  },
  mounted() {
    setTimeout(() => {
      this.showSvg = true;
    }, 0); 
  }
  
  }
  </script>

<template>
    <div class="login">
      <div class="left-content">
        <div class="left-container">
          <div class="d-flex column gap12">
            <svg xmlns="http://www.w3.org/2000/svg" width="200" height="126" viewBox="0 0 200 126" fill="none">
              <g clip-path="url(#clip0_202_1390)">
              <rect width="200" height="126" rx="20" fill="#5565FF"/>
              <path d="M92.0107 70C91.5889 70 91.4512 69.8066 91.5977 69.4199L95.9043 58.1084C96.0859 57.6338 96.3613 57.3965 96.7305 57.3965H97.9609C98.3301 57.3965 98.6055 57.6338 98.7871 58.1084L103.094 69.4199C103.24 69.8066 103.103 70 102.681 70H101.283C100.896 70 100.627 69.7979 100.475 69.3936L99.5781 67.0293H95.1133L94.2168 69.3936C94.0645 69.7979 93.7949 70 93.4082 70H92.0107ZM95.9307 64.8496H98.7607L97.6797 62.0547C97.5508 61.7266 97.4717 61.4893 97.4424 61.3428C97.4189 61.1904 97.3926 60.9678 97.3633 60.6748H97.3281C97.2988 60.9678 97.2695 61.1904 97.2402 61.3428C97.2168 61.4893 97.1406 61.7266 97.0117 62.0547L95.9307 64.8496ZM105.273 70C104.863 70 104.658 69.7803 104.658 69.3408V58.0557C104.658 57.6162 104.863 57.3965 105.273 57.3965H106.697C107.049 57.3965 107.225 57.6162 107.225 58.0557V67.8203H112.349C112.788 67.8203 113.008 68.0107 113.008 68.3916V69.4287C113.008 69.8096 112.788 70 112.349 70H105.273ZM114.221 63.6982C114.221 61.6768 114.748 60.0713 115.803 58.8818C116.857 57.6924 118.352 57.0977 120.285 57.0977C121.451 57.0977 122.365 57.2471 123.027 57.5459C123.695 57.8447 124.281 58.3076 124.785 58.9346C125.09 59.3154 125.081 59.6113 124.759 59.8223L123.757 60.4727C123.464 60.666 123.15 60.5811 122.816 60.2178C122.541 59.9189 122.192 59.6699 121.771 59.4707C121.349 59.2715 120.883 59.1719 120.373 59.1719C119.143 59.1719 118.267 59.5615 117.745 60.3408C117.224 61.1143 116.963 62.2334 116.963 63.6982C116.963 65.1631 117.224 66.2852 117.745 67.0645C118.267 67.8379 119.143 68.2246 120.373 68.2246C120.971 68.2246 121.486 68.166 121.92 68.0488C122.354 67.9258 122.764 67.7061 123.15 67.3896V65.8164H121.243C120.804 65.8164 120.584 65.626 120.584 65.2451V64.208C120.584 63.8271 120.804 63.6367 121.243 63.6367H125.058C125.497 63.6367 125.717 63.8271 125.717 64.208V68.6729C124.896 69.2764 124.067 69.6982 123.229 69.9385C122.397 70.1787 121.416 70.2988 120.285 70.2988C118.381 70.2988 116.893 69.7041 115.82 68.5146C114.754 67.3252 114.221 65.7197 114.221 63.6982ZM127.457 63.6982C127.457 61.6768 127.979 60.0713 129.021 58.8818C130.064 57.6924 131.553 57.0977 133.486 57.0977C135.42 57.0977 136.908 57.6924 137.951 58.8818C138.994 60.0713 139.516 61.6768 139.516 63.6982C139.516 65.7197 138.994 67.3252 137.951 68.5146C136.908 69.7041 135.42 70.2988 133.486 70.2988C131.553 70.2988 130.064 69.7041 129.021 68.5146C127.979 67.3252 127.457 65.7197 127.457 63.6982ZM130.199 63.6982C130.199 65.1631 130.46 66.2852 130.981 67.0645C131.509 67.8379 132.344 68.2246 133.486 68.2246C134.629 68.2246 135.461 67.8379 135.982 67.0645C136.51 66.2852 136.773 65.1631 136.773 63.6982C136.773 62.2334 136.51 61.1143 135.982 60.3408C135.461 59.5615 134.629 59.1719 133.486 59.1719C132.344 59.1719 131.509 59.5615 130.981 60.3408C130.46 61.1143 130.199 62.2334 130.199 63.6982ZM142.293 70C141.883 70 141.678 69.7803 141.678 69.3408V58.0557C141.678 57.6162 141.883 57.3965 142.293 57.3965H146.362C148.173 57.3965 149.494 57.6777 150.326 58.2402C151.158 58.7969 151.574 59.7051 151.574 60.9648C151.574 61.9023 151.237 62.6494 150.563 63.2061C149.89 63.7627 149.034 64.1318 147.997 64.3135V64.3311C148.56 64.542 148.984 64.835 149.271 65.21C149.559 65.585 149.793 65.9131 149.975 66.1943L151.908 69.2441C152.23 69.748 152.119 70 151.574 70H150.045C149.723 70 149.459 69.8271 149.254 69.4814L147.479 66.5195C147.285 66.2031 146.931 65.8574 146.415 65.4824C145.905 65.1016 145.398 64.9111 144.895 64.9111H144.244V69.3408C144.244 69.7803 144.039 70 143.629 70H142.293ZM144.244 62.7314H145.817C146.989 62.7314 147.821 62.5996 148.313 62.3359C148.812 62.0664 149.061 61.6416 149.061 61.0615C149.061 60.4287 148.82 60.0186 148.34 59.8311C147.865 59.6377 147.165 59.541 146.239 59.541H144.244V62.7314ZM154.844 70C154.434 70 154.229 69.7803 154.229 69.3408V58.0557C154.229 57.6162 154.434 57.3965 154.844 57.3965H156.18C156.59 57.3965 156.795 57.6162 156.795 58.0557V69.3408C156.795 69.7803 156.59 70 156.18 70H154.844ZM159.159 59.6465C158.72 59.6465 158.5 59.4561 158.5 59.0752V57.9678C158.5 57.5869 158.72 57.3965 159.159 57.3965H168.194C168.634 57.3965 168.854 57.5869 168.854 57.9678V59.0752C168.854 59.4561 168.634 59.6465 168.194 59.6465H164.96V69.5166C164.96 69.8389 164.813 70 164.521 70H162.833C162.54 70 162.394 69.8389 162.394 69.5166V59.6465H159.159ZM171.174 70C170.764 70 170.559 69.7803 170.559 69.3408V58.0557C170.559 57.6162 170.764 57.3965 171.174 57.3965H173.723C174.062 57.3965 174.306 57.6309 174.452 58.0996L176.834 65.8076C176.939 66.1416 177.013 66.417 177.054 66.6338C177.095 66.8447 177.13 67.0967 177.159 67.3896H177.212C177.241 67.0967 177.276 66.8447 177.317 66.6338C177.358 66.417 177.432 66.1416 177.537 65.8076L179.919 58.0996C180.065 57.6309 180.309 57.3965 180.648 57.3965H183.197C183.607 57.3965 183.812 57.6162 183.812 58.0557V69.3408C183.812 69.7803 183.607 70 183.197 70H181.861C181.451 70 181.246 69.7803 181.246 69.3408V62.0811C181.246 61.7295 181.261 61.3779 181.29 61.0264H181.229L178.688 69.2881C178.542 69.7627 178.29 70 177.933 70H176.438C176.081 70 175.829 69.7627 175.683 69.2881L173.143 61.0264H173.081C173.11 61.3779 173.125 61.7295 173.125 62.0811V69.3408C173.125 69.7803 172.92 70 172.51 70H171.174Z" fill="white"/>
              <path d="M62.8179 65.1774L56.2528 78.3481L48.51 83.9098V75.8889L58.0151 57.3919L43.5851 34L25.1288 66.8483L34.4638 66.9424L43.5851 51.3164L47.4936 57.1762L37.3603 75.8889H20.0469L15.4928 84H48.3835H48.51H74.43L62.8179 65.1774Z" fill="white"/>
              <path d="M49.2428 79.3012V82.5292L52.0215 80.5681C52.0215 80.5681 50.0847 80.674 49.2428 79.3012Z" fill="white"/>
              <path d="M50.7 76.1125L51.0097 76.238C51.1266 76.2886 51.2535 76.3177 51.3831 76.3236C51.5127 76.3295 51.6423 76.312 51.7642 76.2721C51.8861 76.2323 51.998 76.1709 52.0931 76.0916C52.1883 76.0124 52.2649 75.9168 52.3183 75.8105L60.1266 60.6708L58.7569 58.447L50.2289 74.9476C50.1214 75.1585 50.1105 75.3989 50.1987 75.6169C50.2868 75.8349 50.4669 76.013 50.7 76.1125Z" fill="white"/>
              <path d="M53.6571 77.6578L53.9625 77.7872C54.0794 77.8379 54.2063 77.867 54.3359 77.8729C54.4655 77.8787 54.5951 77.8612 54.717 77.8214C54.8389 77.7816 54.9508 77.7202 55.046 77.6409C55.1411 77.5616 55.2177 77.466 55.2712 77.3597L62.1677 63.9812L60.7937 61.7534L53.1817 76.4968C53.1281 76.6011 53.0979 76.7139 53.0928 76.8287C53.0877 76.9435 53.1078 77.0581 53.1519 77.1659C53.1961 77.2737 53.2634 77.3726 53.3501 77.457C53.4368 77.5415 53.5411 77.6097 53.6571 77.6578Z" fill="white"/>
              </g>
              <defs>
              <clipPath id="clip0_202_1390">
              <rect width="200" height="126" rx="20" fill="white"/>
              </clipPath>
              </defs>
              </svg>
            <h3 class="login-title">Xush kelibsiz</h3>
            <p>Iltimos login va parolingizni kiriting</p>
          </div>
          <div class="login-container-form">
            <div class="form-item d-flex radius1 border1">
              <input type="text" :value="login" @input="login = $event.target.value.trim()" placeholder="Ismingizni kiriting">
              <Icons name="user" />
            </div>
            <div class="form-item d-flex radius1 border1">
              <input :type="!type ? 'password' : 'text'" :value="password" @input="password = $event.target.value.trim()" placeholder="Parolingizni kiriting">
              <Icons name="password" @click="type = !type" />
            </div>
            <button type="button" @click="handleLogin" class="login-create">Sahifaga kirish</button>
          </div>
        </div>
      </div>
      <div class="right-content">
        <svg xmlns="http://www.w3.org/2000/svg" width="600" height="110" viewBox="0 0 1158 110" fill="none">
          <path d="M0.200001 13.86V110H24.14V66.3H61V44.64H24.14V22.22H61V0.749991H21.86L0.200001 13.86ZM131.11 13.86V110H107.17V66.3H69.55V44.64H107.17V22.22H69.55V0.749991H108.69L131.11 13.86ZM169.04 0.749991H192.98V87.77H229.08V110H169.04V0.749991ZM239.15 87.77V110H299.95V87.77H239.15ZM320.818 13.86V97.08L343.048 110H381.618V88.53H345.518V23.17H382.378V0.749991H343.048L320.818 13.86ZM452.488 36.09H427.788V23.17H390.928V0.749991H430.258L452.488 13.86V36.09ZM452.488 44.64V97.08L430.258 110H391.688V88.53H427.788V66.3H390.928V44.64H452.488ZM486.6 13.86L508.83 0.749991H548.16V22.22H510.54V87.77H547.4V110H508.83L486.6 97.08V13.86ZM617.51 13.86L596.04 0.749991H556.71V22.22H593.57V87.77H556.71V110H596.04L617.51 97.08V13.86ZM655.44 0.749991H716.24V23.17H679.38V44.64H716.24V66.87H679.38V110H655.44V0.749991ZM786.35 110V64.78L768.49 55.47L786.35 46.92V13.86L763.93 0.749991H724.79V23.17H762.41V44.64H724.79V66.87H762.41V110H786.35ZM818.721 0.749991H842.661V110H818.721V0.749991ZM998.297 22.22H943.577V110H917.357V22.22H867.387V0.749991H998.297V22.22ZM1026.8 0.749991H1048.46L1087.6 37.61V66.3L1050.74 31.53V110H1026.8V0.749991ZM1157.71 0.749991H1136.24L1096.91 37.61V66.3L1133.77 31.53V110H1157.71V0.749991Z" fill="white"/>
          </svg>
      </div>
    </div>
    <Toastiff :toastOptions="toastOptions" />
  </template>
 